name: CI RCLC

on:
    pull_request:
      branches: 
        - '**'

jobs:

    rolling:
        runs-on: ubuntu-20.04
        container: ros:foxy
    
        steps:
        - uses: actions/checkout@v2
          with:
            path: src/rmw-microxrcedds

        - name: Download dependencies
          run: |
            git clone -b foxy https://github.com/osrf/osrf_testing_tools_cpp src/osrf_testing_tools_cpp
      
        - name: Build
          run: . /opt/ros/$ROS_DISTRO/setup.sh && colcon build --cmake-args -DCMAKE_CXX_FLAGS="-Werror" -DCMAKE_C_FLAGS="-Werror" 

        - name: Test
          run: | 
            . /opt/ros/$ROS_DISTRO/setup.sh && . install/local_setup.sh 
            colcon test
            colcon test-result

    foxy:
        runs-on: ubuntu-20.04
        container: ros:foxy
    
        steps:
        - uses: actions/checkout@v2
          with:
            path: src/rmw-microxrcedds

        - name: Download dependencies
          run: |
            git clone -b foxy https://github.com/osrf/osrf_testing_tools_cpp src/osrf_testing_tools_cpp
      
        - name: Build
          run: . /opt/ros/$ROS_DISTRO/setup.sh && colcon build --cmake-args -DCMAKE_CXX_FLAGS="-Werror" -DCMAKE_C_FLAGS="-Werror" 

        - name: Test
          run: | 
            . /opt/ros/$ROS_DISTRO/setup.sh && . install/local_setup.sh 
            colcon test
            colcon test-result

    eloquent:
        runs-on: ubuntu-20.04
        container: ros:eloquent
    
        steps:
        - uses: actions/checkout@v2
          with:
            path: src/rmw-microxrcedds

        - name: Download dependencies
          run: |
            git clone -b foxy https://github.com/osrf/osrf_testing_tools_cpp src/osrf_testing_tools_cpp
      
        - name: Build
          run: . /opt/ros/$ROS_DISTRO/setup.sh && colcon build --cmake-args -DCMAKE_CXX_FLAGS="-Werror" -DCMAKE_C_FLAGS="-Werror" 

        - name: Test
          run: | 
            . /opt/ros/$ROS_DISTRO/setup.sh && . install/local_setup.sh 
            colcon test
            colcon test-result

    dashing:
        runs-on: ubuntu-20.04
        container: ros:dashing
    
        steps:
        - uses: actions/checkout@v2
          with:
            path: src/rmw-microxrcedds

        - name: Download dependencies
          run: |
            git clone -b foxy https://github.com/osrf/osrf_testing_tools_cpp src/osrf_testing_tools_cpp
      
        - name: Build
          run: . /opt/ros/$ROS_DISTRO/setup.sh && colcon build --cmake-args -DCMAKE_CXX_FLAGS="-Werror" -DCMAKE_C_FLAGS="-Werror" 

        - name: Test
          run: | 
            . /opt/ros/$ROS_DISTRO/setup.sh && . install/local_setup.sh 
            colcon test
            colcon test-result
